services:
  calibre:
    image: lscr.io/linuxserver/calibre:latest
    container_name: Calibre-Desktop
    environment:
      - PUID=1000
      - PGID=100
      - TZ=Europe/Dublin
      
      # FIX 1: Make the screen usable on modern monitors
      - DISPLAY_WIDTH=1920
      - DISPLAY_HEIGHT=1080
      
      # Optional: Improves text rendering slightly
      - LC_ALL=C.UTF-8
      
    volumes:
      - /volume2/FastSSD/docker/calibre/config:/config
      # Mount the library with RW access (CRITICAL: Only use when CWA is stopped!)
      - /volume1/SlowHDD/books/calibreweblib:/calibre-library:rw
      
    ports:
      - 8080:8080 # The Web Interface (KasmVNC)
      - 8081:8081 # The Web Interface (Legacy)
      
      # FIX 2: The "Kill Switch" (See explanation below)
      - 9000:9000 
      
    restart: unless-stopped
    # Allocate shared memory to prevent browser crashes in VNC
    shm_size: "1gb"
    security_opt:
      - seccomp:unconfined # Helps with performance on some hosts
